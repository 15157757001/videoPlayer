<template>
	<div class="content">
		
		<!-- <chunlei-video :title="title" :srcList="srcList" class="video" ref="video" :gDuration="gDuration" color="#22ac38">
		
		</chunlei-video> -->
		<chunlei-video :title="videoList[index-1].title" :srcList="videoList[index-1].srcList" class="video" ref="video" :initialTime="videoList[index-1].initialTime"
			:gDuration="videoList[index-1].gDuration" :episode="11" @playEpi="playEpi" :index="index" :danmuList="videoList[index-1].danmuList" color="#edd1d8">
		
		</chunlei-video>
		
		
		<button @click="tapBtn" class="btn">播放暂停</button>
		<button @click="getCurrent" class="btn">视频当前进度</button>
	</div>
</template>

<script>
	import chunleiVideo from '../../components/chunlei-video/chunlei-video.nvue'
	export default { 
		components:{
			chunleiVideo
		},
		data() {
			return {
				srcList:[
					{title:'流畅',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=low&source=aliyun&playUrlType=url_oss'},
					{title:'标清',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=normal&source=aliyun&playUrlType=url_oss'},
					{title:'高清',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=high&source=aliyun&playUrlType=url_oss'}
				],
				title: '无辣不欢，你没见过小龙虾的大场面',
				gDuration:1162, //大概总时长
				videoList:[{
					srcList:[
						{title:'流畅',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=low&source=aliyun&playUrlType=url_oss'},
						{title:'标清',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=normal&source=aliyun&playUrlType=url_oss'},
						{title:'高清',src:'http://baobab.kaiyanapp.com/api/v1/playUrl?vid=164016&resourceType=video&editionType=high&source=aliyun&playUrlType=url_oss'}
					],
					danmuList:[
						{text: '我就算从这跳下去',color: '#fff',time: 101,avatar:'../../static/avatar.png'},
						{text: '密集恐惧症患者',color: '#fff',time: 101,avatar:'../../static/avatar.png'},
						{text: '也不会吃你一口小龙虾',color: '#fff',time: 103,avatar:'../../static/avatar.png'},
						{text: '也不会吃你一口小龙虾',color: '#fff',time: 104,avatar:'../../static/avatar.png'},
						{text: '也不会吃你一口小龙虾',color: '#fff',time: 105,avatar:'../../static/avatar.png'},
						{text: '也不会吃你一口小龙虾',color: '#fff',time: 106,avatar:'../../static/avatar.png'},
						{text: '也不会吃你一口小龙虾',color: '#fff',time: 107,avatar:'../../static/avatar.png'},
						{text: '真香!!!',color: '#fff',time: 111,avatar:'../../static/avatar.png'},
						{text: '真香！！！！！',color: '#fff',time: 114},
						{text: '真香！！！',color: '#fff',time: 118},
						{text: '前方高能!!!',color: '#fff',time: 123,avatar:'../../static/avatar.png'},
					],
					title: '无辣不欢，你没见过小龙虾的大场面',
					initialTime: 100,
					gDuration:1162, //大概总时长
				}],
				index:1
			}
		},
		async created() {
			//#ifdef APP-PLUS
			plus.screen.lockOrientation("portrait-primary")
			//#endif
			
		},
		async mounted() {
			await this.pushVideoList()
		},
		methods: {
			tapBtn(){
				this.$refs.video.videoPlay()
			},
			//获取视频当前进度
			getCurrent(){
				uni.showToast({
					title:this.$refs.video.getCurrent(),
					icon:'none'
				})
				
			},
			playEpi(val){
				this.index = val
				
			},
			pushVideoList(){
				let promise = new Promise((resolve,reject)=>{
					uni.request({
						url: 'https://api.apiopen.top/videoRecommend?id=127395',
						success: (res) => {
							let videoGroup = []
							for (let item of res.data.result) {
								if(item.type == 'videoSmallCard'){
									for (let itm of item.data.playInfo) {
										
										itm.title = itm.name
										itm.src = itm.url
										
									}
									videoGroup.push({
										srcList:item.data.playInfo,
										title: item.data.title,
										gDuration:item.data.duration, //大概总时长
									})
								}
							}
							this.videoList = [...this.videoList,...videoGroup]
							resolve()
						}
					})
				}) 
				return promise
			},
		}
	}
</script>

<style>
	
	.content {
		
		width: 750rpx;
		
	}
	
	.video{
		height: 200px;
		width: 750rpx;
	}

	.btn{
		margin: 100rpx;
		
	}
	
</style>
